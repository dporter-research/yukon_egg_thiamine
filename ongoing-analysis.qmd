---
title: "Yukon Egg Analysis"
format:
  html: {}
lightbox: true
editor_options:
  chunk_output_type: console
toc: true
editor:
  markdown:
    wrap: 72
---

```{r}
#| label: setup
#| echo: false
#| include: false
library(png)
library(here)
```

## Canada-bound fish (2023)

Here I have filtered to only include fish genetically identified as
Canada-origin from the PIST group, I have also included fish collected
at RARA, FOYU, and WH.

Take home messages from the analyses below, as fish move upriver: 

- Egg mass increases 
- Egg thiamine concentration decreases 
- Egg thiamine total content does not change
- Egg % moisture decreases, then increases 
- Egg total moisture content increases
- Egg % lipid (dry) decreases
- Egg total lipid content increases from PIST
- Egg % protein (dry) estimate increases
- Egg protein content (estimated) increases 

### Overall Egg Contents 

```{r}
#| label: fig-egg-total-content-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Overall contents of Chinook salmon eggs collected at sites along the Yukon river."

knitr::include_graphics("output/figures/total_egg_contents_site_canada.png")
```

Here we can clearly see that eggs are increasing in size, water content, lipid
content, and protein content (estimated) as fish move upriver. However the 
amount of thiamine in each egg is not changing. Letters indicate significantly
different groups.

```{r}
#| label: fig-egg-pct-content-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Percentage makeup of Chinook salmon eggs collected at sites along the Yukon river."

knitr::include_graphics("output/figures/pct_egg_contents_site_canada.png")
```


By comparing the increase in average egg mass with the percentage of egg
contents as fish move upriver we can begin to get an idea of how an egg develops 
over time. 

Total thiamine content remains unchanged as fish move upriver, so 
if looking at thiamine content as a concentration, it appears to decrease as
fish move upriver and eggs get larger.

The other three variables (moisture, lipids, and protein) all increase in content
as the fish move upriver, seemingly at different rates or amounts, though. It 
seems like egg moisture, or water content, is added to the egg early and late
in development. Protein seems to be added at an increasing rate, as estimated protein content incrases as egg mass also increases. Lipids seem to be added at a steady
rate, with the % lipid content slightly decreasing as eggs get larger.

Should probably look at all this again as regression plots.

### Average Egg Mass

#### Distribution

```{r}
#| label: fig-egg-distribution-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Mean egg mass distribution for each Canada-bound collection site."

knitr::include_graphics("output/figures/egg_mass_distribution_canada.png")
```

The average egg mass distribution is largely unchanged when
non-Canada-bound fish are filtered out.

#### Violin Plot

```{r}
#| label: fig-egg-mass-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Average egg mass at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_mass_site_canada.png")

```

Average egg mass is significantly different at each site along the
river. Eggs are getting larger as the fish proceed towards Whitehorse.

These data meet the assumptions of an ANOVA test. The data are mostly
normally distributed, there is homoscedasticity of variance (Levene's
test p > 0.05), and the observations are independent of each other. The
observations are independent because we are only looking at Canada-bound
fish, if we were looking at fish assigned to different "stocks" we would
need to account for the random effect of "stock".

We aren't 100% sure all the fish from RARA and FOYU are Canada "stock"
we need to be sure of this.

### Egg Thiamine Concentration

#### Distribution

```{r}
#| label: fig-egg-thiamine-conc-density-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg thiamine concentration distributions at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_thiamine_concentration_distribution_canada.png")

```

Distributions become more normal as fish migrate upriver and egg
thiamine concentration drops.

#### Violin Plot

```{r}
#| label: fig-egg-thiamine-conc-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg thiamine concentrations at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_thiamine_conc_site_canada.png")

```

Egg thiamine concentration decreases as fish migrate up the river. Fort
Yukon is not significantly different from Whitehorse.

Data are not normally distributed in each group and variance is not
homoscedastic, so ANOVA could not be used. Instead I tested the
difference between groups using the non-parametric Kruskal-Wallis test
and used a post-hoc Dunn's test with Bonferroni adjustment. The
Kruskal-Wallis test compares the group medians (mean ranks) rather than
the means like an ANOVA. Because the variance of each group is not
homoscedastic, all we can confidently say is that the distributions of
the different groupings are different.

### Egg Thiamine Content

#### Distribution

```{r}
#| label: fig-egg-total-thiamine-density-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Total egg thiamine content distributions at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_total_thiamine_distribution_canada.png")

```

Distributions verging from normality at all sites, used non-parametric Kruskal-Wallis
test to test differences.

#### Violin Plot

```{r}
#| label: fig-egg-total-thiamine-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Total egg thiamine content at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_total_thiamine_site_canada.png")

```


Kruskal-Wallis test p-value > 0.05, no significant difference in medians
across sites. Total egg thiamine (nmol/g) does not change along the river.

### Egg Percent Moisture

#### Distribution

```{r}
#| label: fig-egg-pct-moisture-density-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg % moisture distributions at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_pct_moisture_distribution_canada.png")

```

#### Violin Plot

```{r}
#| label: fig-egg-pct-moisture-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg % moisture of Canada-bound fish."

knitr::include_graphics("output/figures/egg_pct_moisture_site_canada.png")

```

Here, we are comparing group medians because the variance is
homoscedastic, but the data are not normally distributed. Again we used
a Kruskal-Wallis test and a post-hoc Dunn's test.

### Egg Total Moisture

#### Distribution

```{r}
#| label: fig-egg-total-moisture-density-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg total moisture content distributions at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_total_moisture_distribution_canada.png")

```

#### Violin Plot

```{r}
#| label: fig-egg-total-moisture-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg total moisture content of Canada-bound fish."

knitr::include_graphics("output/figures/egg_total_moisture_site_canada.png")

```

Again the data are not normally distributed, but we can see an
increasing trend in total moisture content as the fish move up the
river. The variance is homoscedastic so we are comparing the medians of
the different groups.

### Egg % Lipid (dry)

#### Distribution

```{r}
#| label: fig-egg-pct-lipid-density-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg % lipid (dry) distributions at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_pct_lipid_distribution_canada.png")

```

#### Violin Plot

```{r}
#| label: fig-egg-pct-lipid-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg % lipid (dry) of Canada-bound fish."

knitr::include_graphics("output/figures/egg_pct_lipid_site_canada.png")

```

Egg percent lipid (dry) decreases as fish move upriver. Not normally distributed, variance is homoscedastic (Kruskal-Wallis tests differences of medians).

### Egg Total Lipid Content

#### Distribution

```{r}
#| label: fig-egg-total-lipid-density-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg total lipid content distributions at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_total_lipid_distribution_canada.png")

```

Data pass tests for normality and homoscedasticity, 
testing differences of means with ANOVA.

#### Violin Plot

```{r}
#| label: fig-egg-total-lipid-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg total lipid content of Canada-bound fish."

knitr::include_graphics("output/figures/egg_total_lipid_site_canada.png")

```

Lipid content increases from PIST, but all other sites are do not have
significantly different mean lipid content values.

### Egg % Protein Estimate (dry)

#### Distribution

```{r}
#| label: fig-egg-pct-protein-density-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg % protein estimate (dry) distributions at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_pct_protein_distribution_canada.png")

```

Data fail test for normality (FOYU and WH) but pass for homoscedasticity, 
testing differences of medians with Kruskal-Wallis.

#### Violin Plot

```{r}
#| label: fig-egg-pct-protein-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg % protein estimates (dry) of Canada-bound fish."

knitr::include_graphics("output/figures/egg_pct_protein_site_canada.png")

```

Percent protein (dry) estimates increase along the river.

### Egg Total Protein Estimate

#### Distribution

```{r}
#| label: fig-egg-total-protein-density-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg total protein estimate (g) distributions at Canada-bound collection sites."

knitr::include_graphics("output/figures/egg_total_protein_distribution_canada.png")

```

Data fail test for normality but pass for homoscedasticity, 
testing differences of medians with Kruskal-Wallis.

#### Violin Plot

```{r}
#| label: fig-egg-total-protein-violin-canada
#| echo: false
#| fig-align: center
#| fig-cap: "Egg total protein estimates (g) of Canada-bound fish."

knitr::include_graphics("output/figures/egg_total_protein_site_canada.png")

```

Total egg protein content estimates increase along the river.

# 2023 PIST Eggs by Genetic Group

The table below summarizes the number of individuals assigned to each genetic
group at each grouping level.

```{r}
#| label: PIST-genetic-counts
#| echo: false

genetic_counts_table <- readRDS("output/tables/PIST_genetic_group_counts.rds")

knitr::kable(
  genetic_counts_table,
  col.names = c("Grouping Level", "Group Name", "n"),
  caption = "Number of individuals assigned to each genetic grouping."
)

```

I want to start exploration at the "broad_group" level. It seems like it gives
us good sample sizes at 3 group levels to explore.


## Density Distributions

```{r}
#| label: fig-PIST-facetted-density
#| echo: false
#| fig-align: center

knitr::include_graphics("output/figures/PIST_facetted_densities.png")

```



# Under construction from here down
## Distribution Visualizations

### Egg mass distributions

First, I wanted to visualize the average egg mass distribution by
collection site.

```{r}
#| label: fig-egg-distribution-site
#| echo: false
#| fig-cap: "Mean egg mass distribution for each collection site."

knitr::include_graphics("output/figures/egg_mass_distribution_site.png")

```

We can see a general increase in average egg size as the fish move up
the river. Most sites have a generally normal distribution, Chena does
not but there are only 3 fish. I decided to remove Chena and Salcha from
downstream analyses. I can easily add them back in.

```{r}
#| label: fig-egg-distribution-site-no-chalcha
#| echo: false
#| fig-cap: "Mean egg mass distribution for each collection site. Chena and Salcha are removed."

knitr::include_graphics("output/figures/egg_mass_distribution_site_nochalcha.png")

```
